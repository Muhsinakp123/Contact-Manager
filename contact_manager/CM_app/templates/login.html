{% extends 'master.html' %}
{% block title %}Login{% endblock %}

{% block content %}
<div class="login-container">
    <h2>Login</h2>

    <!-- Error message -->
    {% if error %}
        <p id="errorMsg" style="color:red;">{{ error }}</p>
    {% endif %}

    <form method="post" id="loginForm">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Log In</button>
    </form>

    <!-- Hidden forgot password form (used for redirect check) -->
    <form method="post" action="{% url 'forgot_password' %}" id="forgotForm" style="display:none;">
        {% csrf_token %}
        <input type="hidden" name="username" id="forgot_username">
    </form>

    <!-- Forgot password link -->
    <p>
        <a href="#" id="forgotLink" class="forgot-link">Forgot Password?</a>
    </p>

    <p>Don't have an account? <a href="{% url 'signup' %}">Sign up</a></p>
</div>

<script>
    const loginUsername = document.querySelector('input[name="username"]');
    const forgotUsername = document.getElementById('forgot_username');
    const forgotForm = document.getElementById('forgotForm');
    const forgotLink = document.getElementById('forgotLink');
    const errorMsg = document.getElementById('errorMsg');

    // Handle "Forgot Password?" link
    forgotLink.addEventListener('click', (e) => {
        e.preventDefault();
        const usernameValue = loginUsername.value.trim();

        if (!usernameValue) {
            alert("Please enter your username first.");
            return;
        }

        forgotUsername.value = usernameValue;
        forgotForm.submit();
    });

    // ðŸ§¹ Auto-clear the error message when user starts typing again
    loginUsername.addEventListener('input', () => {
        if (errorMsg) {
            errorMsg.style.display = 'none';
        }
    });
</script>
{% endblock %}
